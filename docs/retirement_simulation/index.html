<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-13 Mon 15:37 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=1024, initial-scale=1" />
<title>Fortran Finance</title>
<meta name="author" content="Mitch Richling" />
<meta name="description" content="Documentation for monte carlo examples in the Fortran Finance repository." />
<meta name="keywords" content="finance fortran monte carlo inflation cashflow time value of money tvm percentages taxes stock market" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style>body { width: 95%; margin: 2% auto; font-size: 18px; line-height: 1.4em; font-family: Georgia, serif; color: black; background-color: white; }</style>
<style>body { min-width: 500px; max-width: 1024px; }</style>
<style>h1,h2,h3,h4,h5,h6 { color: #A5573E; line-height: 1em; font-family: Helvetica, sans-serif; }</style>
<style>h1,h2,h3 { line-height: 1.4em; }</style>
<style>h1.title { font-size: 3em; }</style>
<style>.subtitle { font-size: 0.6em; }</style>
<style>h4,h5,h6 { font-size: 1em; }</style>
<style>.org-src-container { border: 1px solid #ccc; box-shadow: 3px 3px 3px #eee; font-family: Lucida Console, monospace; font-size: 80%; margin: 0px; padding: 0px 0px; position: relative; }</style>
<style>.org-src-container>pre { line-height: 1.2em; padding-top: 1.5em; margin: 0.5em; background-color: #404040; color: white; overflow: auto; }</style>
<style>.org-src-container>pre:before { display: block; position: absolute; background-color: #b3b3b3; top: 0; right: 0; padding: 0 0.2em 0 0.4em; border-bottom-left-radius: 8px; border: 0; color: white; font-size: 100%; font-family: Helvetica, sans-serif;}</style>
<style>pre.example { white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -o-pre-wrap; font-family: Lucida Console, monospace; font-size: 80%; background: #404040; color: white; display: block; padding: 0em; border: 2px solid black; }</style>
<style>blockquote { margin-bottom: 0.5em; padding: 0.5em; background-color: #FFF8DC; border-left: 2px solid #A5573E; border-left-color: rgb(255, 228, 102); display: block; margin-block-start: 1em; margin-block-end: 1em; margin-inline-start: 5em; margin-inline-end: 5em; } </style>
<style>#content { max-width: 60em; }</style>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="https://richmit.github.io/FortranFinance/index.html"> UP </a>
 |
 <a accesskey="H" href="https://github.com/richmit/FortranFinance"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Fortran Finance
<br />
<span class="subtitle">Retirement Simulation</span>
</h1>
<table border="2 solid #ccc" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" align="center">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right"><b>Author:</b></td>
<td class="org-left"><i>Mitch Richling</i></td>
</tr>

<tr>
<td class="org-right"><b>Updated:</b></td>
<td class="org-left"><i>2025-01-13 15:37:38</i></td>
</tr>

<tr>
<td class="org-right"><b>Generated:</b></td>
<td class="org-left"><i>2025-01-13 15:37:39</i></td>
</tr>
</tbody>
</table>
<p align="center">
Copyright &copy; 2025 Mitch Richling. All rights reserved.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#intro">1. Introduction</a>
<ul>
<li><a href="#model">1.1. The Model</a></li>
<li><a href="#graphsR">1.2. Model Analysis</a>
<ul>
<li><a href="#graphsR-fixed">1.2.1. When retire.out contains a single simulation (no monte carlo), then three visualizations will be produced:</a></li>
<li><a href="#graphsR-mc">1.2.2. When retire.out contains multiple simulations (monte carlo), then eight visualizations are produced:</a></li>
</ul>
</li>
<li><a href="#obs">1.3. Some Observations</a></li>
<li><a href="#future">1.4. Future Plans</a></li>
<li><a href="#commonprob">1.5. Evaluating retirement planning software</a></li>
</ul>
</li>
<li><a href="#ops">2. Operation</a>
<ul>
<li><a href="#env">2.1. Environment</a></li>
<li><a href="#down">2.2. Download</a></li>
<li><a href="#build">2.3. Software Build</a></li>
<li><a href="#dowrun">2.4. Running The Simulator</a></li>
</ul>
</li>
<li><a href="#examples">3. Examples</a>
<ul>
<li><a href="#case_20_intro">3.1. Just Starting Out</a>
<ul>
<li><a href="#case_20_fixed">3.1.1. Fixed</a></li>
<li><a href="#case_20_mc">3.1.2. MC</a></li>
<li><a href="#case_20_config">3.1.3. Config File</a></li>
</ul>
</li>
<li><a href="#case_60_intro">3.2. Approaching Retirement</a>
<ul>
<li><a href="#case_60_danger">3.2.1. A Risky Plan</a></li>
<li><a href="#case_60o_ml">3.2.2. An Alternate Plan</a></li>
<li><a href="#case_60_config">3.2.3. Config Files</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#platforms">4. Platform Notes &amp; Testing</a>
<ul>
<li><a href="#testenv">4.1. Tested Environments</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-intro" class="outline-2">
<h2 id="intro"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-intro">
<p>
One can go quite far in answering retirement questions using nothing more than TVM computations with fixed approximations for things like taxes, investment
growth, and inflation.  As retirement became more of a reality, I found myself asking questions these kinds of approximations simply couldn't address.  So I
wrote this little tool &#x2013; it essentially simulates the annual financial transactions for a retired couple.
</p>
</div>

<div id="outline-container-model" class="outline-3">
<h3 id="model"><span class="section-number-3">1.1.</span> The Model</h3>
<div class="outline-text-3" id="text-model">
<ul class="org-ul">
<li>Inflation can be a fixed rate or monte carlo.</li>
<li>The couple have a fixed set of expenses to meet every year (a budget).  This budget grows with inflation.  
<ul class="org-ul">
<li>Expenses are broken into shared expenses and expenses related to each person.  Person specific expenses disappear when the associated person dies.</li>
<li>Use the following sources in order for expenses: income, brokerage, IRA, Roth, &amp; emergency fund.</li>
<li>This draw down strategy leads to a dip in tax rate in the early years I can use to make Roth conversions.</li>
<li>IRAs &amp; Roth IRAs
<ul class="org-ul">
<li>Never use an IRA (regular or Roth) if the account holder is &lt;60.</li>
<li>Never use a Roth IRA if the account was converted less than 5 years ago.</li>
<li>The "never use" rules could lead to unpaid expenses &#x2013; So be on the lookout for that, and adjust as required.</li>
</ul></li>
</ul></li>
<li>They share a checking account in which they maintain a fixed balance growing with inflation.
<ul class="org-ul">
<li>If necessary, savings in other accounts are used to maintain that balance using the same draw down strategy as expenses.</li>
</ul></li>
<li>Retirement Savings
<ul class="org-ul">
<li>Each partner has an IRA and a Roth IRA</li>
<li>They share a brokerage account</li>
<li>Savings investments
<ul class="org-ul">
<li>All accounts share the same blend of investments: high returns, medium returns, low returns, and cash position</li>
<li>Each group has it's own return characteristics (fixed APR or monte carlo)</li>
<li>All funds can be moved to the cash position if total assets are sufficient to meet future expenses under a worst case inflation condition.</li>
</ul></li>
</ul></li>
<li>Each partner has a job.  
<ul class="org-ul">
<li>They each have a retirement date at which they will stop working.</li>
<li>While they work, they contribute to to their IRA. Maximum contributions are comprehended including "catch up" contributions after age 50.</li>
<li>Some percentage of unused income (income not used for expenses) can be saved in the brokerage account.</li>
</ul></li>
<li>Each partner will eventually draw Social Security
<ul class="org-ul">
<li>They each have a year at which they will draw benefits.</li>
<li>Benefits are expected to grow &#x2013; this can be tied to inflation, or set to an alternate fixed rate.</li>
</ul></li>
<li>Taxes are estimated for each year including
<ul class="org-ul">
<li>Income taxes</li>
<li>Tax impact of IRA withdrawals</li>
<li>Capital gains in the brokerage &amp; emergency fund
<ul class="org-ul">
<li>These are taxed in the year they are made at the short range rate</li>
</ul></li>
<li>Tax brackets are projected forward with inflation.</li>
<li>They take the standard deduction.  This is also projected forward with inflation.</li>
<li>They file joint until one of them dies.</li>
<li>Taxes are paid with the same strategy as expenses.</li>
</ul></li>
<li>They share an "emergency" fund invested in low risk investments.  
<ul class="org-ul">
<li>Funds used as a last resort.</li>
<li>Return rate can be fixed or monte carlo</li>
</ul></li>
<li>Roth Conversions
<ul class="org-ul">
<li>We convert part of IRA accounts to a Roth IRAs if that year's taxable income is below a set target.</li>
<li>We convert p2 IRA accounts first, and then p1 IRA accounts.</li>
</ul></li>
<li>Life expectancy
<ul class="org-ul">
<li>Can be automatically guessed from birth year &amp; sex &#x2013; Uses US SS actuarial tables</li>
<li>Can be monte carlo &#x2013; using US SS actuarial tables taking into account current age &amp; sex</li>
<li>Can be set to a fixed value.  In this case, sex need not be provided in the config.</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-graphsR" class="outline-3">
<h3 id="graphsR"><span class="section-number-3">1.2.</span> Model Analysis</h3>
<div class="outline-text-3" id="text-graphsR">
<p>
As mentioned above, the primary tool is a simulator.  The simulator dumps out the results of the simulation by year &#x2013; account balances, taxes, expenses,
account conversions, etc&#x2026;  You can analyze the data however you wish. I know many people will simply load it into Excel, but I have included an
<a href="https://www.mitchr.me/SS/tools/index.html#stats">R</a> script if that's your thing.  This script will consume the output of the simulation, and produce a
number of image files.  I'll describe them here, but I think it's easier to just take a look at some <a href="#examples">examples</a>.
</p>
</div>

<div id="outline-container-graphsR-fixed" class="outline-4">
<h4 id="graphsR-fixed"><span class="section-number-4">1.2.1.</span> When retire.out contains a single simulation (no monte carlo), then three visualizations will be produced:</h4>
<div class="outline-text-4" id="text-graphsR-fixed">
<ul class="org-ul">
<li><code>savings_by_type.png</code>  Total savings over time broken out by savings type</li>
<li><code>paid_and_unpaid.png</code>  Amount of living expenses &amp; taxes that were successfully paid</li>
<li><code>paid_by_source.png</code>   How obligations were paid by payment source</li>
</ul>
</div>
</div>

<div id="outline-container-graphsR-mc" class="outline-4">
<h4 id="graphsR-mc"><span class="section-number-4">1.2.2.</span> When retire.out contains multiple simulations (monte carlo), then eight visualizations are produced:</h4>
<div class="outline-text-4" id="text-graphsR-mc">
<ul class="org-ul">
<li><code>death_distribution.png</code>                  Histogram for each person showing when they died in the simulations</li>
<li><code>final_savings_by_type.png</code>               Histogram for final savings balance at death</li>
<li><code>probability_of_failure_by_year.png</code>      Histogram showing number of failure trajectories over time</li>
<li><code>savings_by_year_boxplot.png</code>             Box plot showing total savings balance over time along with number of failures</li>
<li><code>savings_by_year_probability_bands.png</code>   Shows bands containing the given percentage of total savings balance trajectories</li>
<li><code>probability_of_success_by_year.png</code>      Line plot showing the probability of failure over time</li>
<li><code>composite_trajectories.png</code>              Composite of total balance trajectories</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-obs" class="outline-3">
<h3 id="obs"><span class="section-number-3">1.3.</span> Some Observations</h3>
<div class="outline-text-3" id="text-obs">
<ul class="org-ul">
<li>Careful tax panning may be a larger factor in a successful retirement than portfolio mix!</li>
<li>Proper portfolio mix and balancing is critical for maximizing income and minimizing risk.</li>
<li>Roth conversions can be a huge deal in maximizing long term growth.</li>
<li>Good visualizations are very important for understanding what's going on</li>
<li>Monte carlo is an important component in understanding and mitigating risk, but it requires very careful analysis.</li>
<li>Inflation really must be comprehended at every level.</li>
</ul>
</div>
</div>

<div id="outline-container-future" class="outline-3">
<h3 id="future"><span class="section-number-3">1.4.</span> Future Plans</h3>
<div class="outline-text-3" id="text-future">
<ul class="org-ul">
<li>Add a way to remix investments later in retirement</li>
<li>Add a way to change savings draw down later 
<ul class="org-ul">
<li>Main use case: Switch from IRA first to IRA/Roth mix to level out tax burden.</li>
</ul></li>
<li>Black–Scholes MC &#x2013; this is mostly an academic curiosity for me.</li>
<li>Social Security survivor benefits &#x2013; not sure I really need this one.</li>
<li>Back testing in addition to monte carlo &#x2013; super low priority.</li>
<li>Add support for annuity that begins upon retirement.
<ul class="org-ul">
<li>Use case: RBA support with a perpetual annuity option</li>
</ul></li>
<li><del>IRA to Roth IRA conversions</del> (Completed 2025-01-10)</li>
<li><del>Add 10 year US treasury bond yield</del> (Completed 2025-01-06)</li>
<li><del>Switch to correlated monte carlo.  Yes.  It's currently uncorrelated.  That's bad.  More of a bug really.</del> (Completed 2025-01-07)</li>
<li><del>Support systems without STDOUT redirection.</del> (Completed 2025-01-08)</li>
<li><del>Print error messages to STDERR instead of STDOUT</del> (Completed 2025-01-08)</li>
<li><del>Add support for progress messages to STDOUT</del> (Completed 2025-01-08)</li>
<li><del>Support different SSI benefit levels.</del> (Completed 2025-01-08)</li>
<li><del>Life Expectancy</del> (Completed 2025-01-12)
<ul class="org-ul">
<li><del>Life Table</del> (Completed 2025-01-12)
<ul class="org-ul">
<li><del>Add SSI Life tables module</del> (Completed 2025-01-11)</li>
<li><del>Data</del> (Completed 2025-01-11)
<ul class="org-ul">
<li><del>SSI male &amp; female px * lx data</del> (Completed 2025-01-11)</li>
<li><del>CDC all, male, female, white people, white males, white females</del> (Completed 2025-01-11)</li>
</ul></li>
<li><del>Life table computations: Given age and qx or lx, compute: qx (when given lx), lx (when given qx), dx, Lx, Tx, ex, mx, &amp; px</del> (Completed 2025-01-11)</li>
<li><del>Compute the maximum age a person might reach (the year at which everyone is dead in the life table)</del> (Completed 2025-01-11)</li>
<li><del>Compute probably a person at a given age a given number of years</del> (Completed 2025-01-11)</li>
<li><del>Add random generator that uses life table as the distribution.  Take age into consideration.</del> (Completed 2025-01-12)</li>
</ul></li>
<li><del>simulation changes</del> (Completed 2025-01-12)
<ul class="org-ul">
<li><del>Option to set simulation end at highest survivor date in life table for sex of person</del> (Completed 2025-01-12)</li>
<li><del>Add graph showing probability of running out of cash by given date</del> (Completed 2025-01-12)</li>
<li><del>Add dots to the trajectory graph showing when both people died</del> (Completed 2025-01-12)</li>
<li><del>Do MC lifespan</del> (Completed 2025-01-12)</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-commonprob" class="outline-3">
<h3 id="commonprob"><span class="section-number-3">1.5.</span> Evaluating retirement planning software</h3>
<div class="outline-text-3" id="text-commonprob">
<p>
I did a ton of research before I wrote this simulator.  I looked at dozens of wealth management and retirement planning tools.  Some free and some very
expensive.  Some super simple and some quite sophisticated.  Some utterly terrible and some pretty good.  In the end I have found myself using a couple online
tools in combination with this simulator.
</p>

<p>
One thing I realized is that there is no universal measure of quality or fitness for these kinds of tools.  At the end of the day it's all about your
situation and goals that determine if a tool will help you or not. So, it is important that you do your research.
</p>

<p>
In this section I have documented some of the common issues I found with various tools without naming any names.  My hope is that this list might help others
in doing the same kind of research.
</p>

<ul class="org-ul">
<li>Monte carlo deficiencies 
<ul class="org-ul">
<li>Not using historical data for simulation parameters.
<ul class="org-ul">
<li>Seriously.  I came across a couple client side JavaScript retirement calculators that were just doing uniform random numbers between -7 and 7 for
market returns.  That's pure trash.</li>
</ul></li>
<li>GBM models dubious parameter values.  
<ul class="org-ul">
<li>It's impossible to tell the difference between the result of an incorrect analysis of historical data and a made up number.</li>
<li>It is impossible to trust this kind of simulation unless they disclose the source for parameters.  My policy on this one is that if they won't share,
then I can't trust them.  It's that simple.</li>
</ul></li>
<li>Ignoring correlation
<ul class="org-ul">
<li>Uncorrelated GBM models for blended investments &#x2013; like bonds mixed with stocks.</li>
<li>Ignoring the correlation between inflation and bond returns.</li>
</ul></li>
<li>Only doing MC on investment returns and not inflation.</li>
<li>Poor visualization and analysis capabilities for the results of MC simulations.
<ul class="org-ul">
<li>As I side note, I am convinced some of these tools exist only to publish the "probability of failure" metric as a marketing strategy.  They hope to scare
people into paying for a financial advisor.</li>
</ul></li>
<li>Unwillingness to divulge the underlying models and assumptions.  
<ul class="org-ul">
<li>This is a deal breaker for me.  It's like the GBM parameter item above &#x2013; if they won't tell, then I won't trust them.</li>
<li>Note I'm not talking about "secret sauce" or "proprietary intellectual property".  I'm talking about the essential information required to understand
the results.  How can we trust the "stock returns" MC if we don't even know what part of the market it's modeling?  Is it comprehending dividends and
splits as part of the adjusted rate of return?  How is the REIT model incorporating dividends, and what is the reinvestment model?</li>
<li>One thing to know: If they don't have it documented, then ask them.  Many of the larger banks are more than willing to share this stuff.  Frequently
they don't have it in formal documentation posted on the web page, but they do have it readily available for advisors so they can communicate the
answers.</li>
</ul></li>
</ul></li>
<li>Poor tax estimation 
<ul class="org-ul">
<li>Blindly assuming a fixed tax rate over time is very common.
<ul class="org-ul">
<li>Note that some of the large banks do this, but they tune the rate to you.  They use your net worth and expenses to fit a fixed tax rate under the
assumption of a savings draw-down strategy that will flatten out your taxes over time.  So the fixed tax rate thing isn't always bad, but you need to
make sure the tool is being intelligent and not just "blindly picking a number".</li>
</ul></li>
<li>Not adjusting tax brackets for inflation.</li>
<li>Inability to specify tax filing status and deduction methodology.</li>
<li>Not considering age related early withdrawal penalties for retirement accounts.</li>
</ul></li>
<li>Roth conversions 
<ul class="org-ul">
<li>Most tools simply don't have the ability to plan for them at all</li>
<li>Failing to comprehend the 5 year withdrawal penalties</li>
<li>Failing to correctly compute tax consequences at time of conversion.</li>
</ul></li>
<li>Social Security 
<ul class="org-ul">
<li>Not comprehending when one partner dies, or only having one SSI monthly value for the couple.</li>
<li>Not supporting, or incorrectly supporting, survivor benefits.</li>
</ul></li>
<li>Most tools don't allow you to use MC on life span</li>
<li>Data security &amp; privacy
<ul class="org-ul">
<li>Make sure they have a published privacy policy.  If they don't, assume anything you give them will be sold.</li>
<li>Do your best to verify data security.</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-ops" class="outline-2">
<h2 id="ops"><span class="section-number-2">2.</span> Operation</h2>
<div class="outline-text-2" id="text-ops">
<p>
The simulator may be found in the <a href="https://github.com/richmit/FortranFinance">FortranFinance</a> package under the sub-directory <code>retirement_simulation</code>.  This
document forms the primary documentation, and its permanent home is <a href="https://richmit.github.io/FortranFinance/retirement_simulation/index.html">here</a>.
</p>
</div>

<div id="outline-container-env" class="outline-3">
<h3 id="env"><span class="section-number-3">2.1.</span> Environment</h3>
<div class="outline-text-3" id="text-env">
<p>
The simulator is designed to run in a command line environment (MSYS2 on Windows, UNIX, Linux, Linux on WSL, MacOS X).  I expect that you already have a
<a href="https://www.mitchr.me/SS/tools/index.html#fortran">Fortran development environment</a>, <a href="https://www.mitchr.me/SS/tools/index.html#scm">git</a>, and
<a href="https://www.mitchr.me/SS/tools/index.html#code-build">GNU Make</a> installed.  In order to run the visualizations, you will need
<a href="https://www.mitchr.me/SS/tools/index.html#stats">R</a> and the following CRAN packages installed: <code>knitr</code>, <code>jsonlite</code>, <code>quantmod</code>, <code>gridExtra</code>, <code>data.table</code>,
<code>dplyr</code>, <code>tidyr</code>, <code>ggplot2</code>, <code>scales</code>, <code>RColorBrewer</code>.
</p>
</div>
</div>

<div id="outline-container-down" class="outline-3">
<h3 id="down"><span class="section-number-3">2.2.</span> Download</h3>
<div class="outline-text-3" id="text-down">
<p>
The easiest way to download everything is to clone with git:
</p>

<div class="org-src-container">
<pre class="src src-sh">git clone <span style="color: #fa8072;">'https://github.com/richmit/FortranFinance.git'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-build" class="outline-3">
<h3 id="build"><span class="section-number-3">2.3.</span> Software Build</h3>
<div class="outline-text-3" id="text-build">
<p>
The simulator is in the <code>retirement_simulation</code> directory.  That directory contains a <code>makefile</code> that will build the application.  You may need
to edit that makefile for your system configuration &#x2013; follow the instructions  <a href="../MRFFL/index.html#examples">here</a>.  Once you have the
<code>makefile</code> working, you can build with the following command:
</p>

<div class="org-src-container">
<pre class="src src-sh">make retire
</pre>
</div>

<p>
This will result in a executable (named "<code>retire</code>" on most UNIX-like platforms, and "<code>retire.exe</code>" on Windows).  
</p>
</div>
</div>

<div id="outline-container-dowrun" class="outline-3">
<h3 id="dowrun"><span class="section-number-3">2.4.</span> Running The Simulator</h3>
<div class="outline-text-3" id="text-dowrun">
<p>
The <code>retire</code> command takes the name of the the configuration describing the simulation parameters as an optional argument.  If it is missing, then the name
is assumed to be "<code>retire.nml</code>".  This document contains a couple example configuration files: <a href="#case_20_config">config_20.nml</a> and
<a href="#case_60_config">config_60.nml</a>.
</p>

<p>
When run, the <code>retire</code> command will place its results in a file called "<code>retire.out</code>".  This output file is a simple text file that you could load into Excel
to analyze.  I use an <a href="https://www.mitchr.me/SS/tools/index.html#stats">R</a> script for the analysis called "<code>retire.R</code>".  If you run this script, you will
get lots of graphics (see the <a href="#examples">Examples</a> section below).  In summary, you might do the following:
</p>

<div class="org-src-container">
<pre class="src src-sh">./retire.exe my_config.nml
R -q -f retire.R
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-examples" class="outline-2">
<h2 id="examples"><span class="section-number-2">3.</span> Examples</h2>
<div class="outline-text-2" id="text-examples">
</div>

<div id="outline-container-case_20_intro" class="outline-3">
<h3 id="case_20_intro"><span class="section-number-3">3.1.</span> Just Starting Out</h3>
<div class="outline-text-3" id="text-case_20_intro">
<p>
Here we have a couple starting to save for retirement at age 25.  They both have good jobs earning 100K, and they
spend 100K per year on expenses.  Work income is growing at 2.5%. They currently have no retirement savings, but wish
to start saving aggressively.  They believe they can earn 4% on investments, and inflation will be about 3%.  Note work
income is not keeping up with inflation. They have 10K in checking and 10K in an emergency fund.  The checking account
earns 0.01% interest, and the emergency fund is in CDs earning 3%.
</p>
</div>

<div id="outline-container-case_20_fixed" class="outline-4">
<h4 id="case_20_fixed"><span class="section-number-4">3.1.1.</span> Fixed</h4>
<div class="outline-text-4" id="text-case_20_fixed">
<p>
The graphs in this section are what you get from <code>retire.R</code> when the simulation has no monte carlo.  This is similar to what most retirement calculators will
generate.
</p>

<p>
This first graph simply shows total savings balance by account type.
</p>


<div id="org3d705e1" class="figure">
<p><a href="pics/savings_by_type_20_fix_full.png"><img src="pics/savings_by_type_20_fix_800x.png" alt="savings_by_type_20_fix_800x.png" /></a>
</p>
</div>

<p>
This graph shows us paid vs unpaid expenses.  Expenses are broken into two categories (taxes &amp; living expenses).
</p>


<div id="orgb2c39be" class="figure">
<p><a href="pics/paid_and_unpaid_20_fix_full.png"><img src="pics/paid_and_unpaid_20_fix_800x.png" alt="paid_and_unpaid_20_fix_800x.png" /></a>
</p>
</div>

<p>
This graph also deals with expenses, but shows how the expenses are paid.  Note the pink bit starting 2050 showing the couple using savings for expenses well
before retirement.  This is what happens when salary doesn't keep up with inflation!
</p>


<div id="orgd3056db" class="figure">
<p><a href="pics/paid_by_source_20_fix_full.png"><img src="pics/paid_by_source_20_fix_800x.png" alt="paid_by_source_20_fix_800x.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-case_20_mc" class="outline-4">
<h4 id="case_20_mc"><span class="section-number-4">3.1.2.</span> MC</h4>
<div class="outline-text-4" id="text-case_20_mc">
<p>
The graphs in this section are what you get from <code>retire.R</code> when the simulation has monte carlo.  
</p>

<p>
This first graph shows the probability the savings balance trajectory will be within the color band.  For example the inner green band contains 50% of all
simulation runs.  The yellow band, which includes the green band, contains 80% of all simulation runs.  You can change the number and bounds for the bands in
the <code>retire.R</code> script.
</p>


<div id="org526dcad" class="figure">
<p><a href="pics/savings_by_year_probability_bands_20_mc_full.png"><img src="pics/savings_by_year_probability_bands_20_mc_800x.png" alt="savings_by_year_probability_bands_20_mc_800x.png" /></a>
</p>
</div>

<p>
This graph shows 2000 savings trajectories, all the failure trajectories (when we went broke), and an envelope for the highest balance for trajectories that
failed.  In essence the green line shows a "safe" balance at which we are unlikely to see failure.  The little blue dots show the ends of trajectories where
both people have died.
</p>


<div id="orge917573" class="figure">
<p><a href="pics/composite_trajectories_20_mc_full.png"><img src="pics/composite_trajectories_20_mc_800x.png" alt="composite_trajectories_20_mc_800x.png" /></a>
</p>
</div>

<p>
This graph is similar to the probability band graph, but is a more traditional presentation for people accustomed to box plots.
</p>


<div id="orga11d0e8" class="figure">
<p><a href="pics/savings_by_year_boxplot_20_mc_full.png"><img src="pics/savings_by_year_boxplot_20_mc_800x.png" alt="savings_by_year_boxplot_20_mc_800x.png" /></a>
</p>
</div>

<p>
This graph shows us the ages at which simulations went broke, and how frequently it occurred for each age group.  Each bar spans three years.
</p>


<div id="org880fc99" class="figure">
<p><a href="pics/probability_of_failure_by_year_20_mc_full.png"><img src="pics/probability_of_failure_by_year_20_mc_800x.png" alt="probability_of_failure_by_year_20_mc_800x.png" /></a>
</p>
</div>

<p>
Lastly we have a graph that shows us the probability distribution of final savings balance at the end of the simulation.
</p>


<div id="org908b71e" class="figure">
<p><a href="pics/final_savings_by_type_20_mc_full.png"><img src="pics/final_savings_by_type_20_mc_800x.png" alt="final_savings_by_type_20_mc_800x.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-case_20_config" class="outline-4">
<h4 id="case_20_config"><span class="section-number-4">3.1.3.</span> Config File</h4>
<div class="outline-text-4" id="text-case_20_config">
<div class="org-src-container">
<pre class="src src-f90">&amp;SIMPARM
monte_carlo_years                   = 40,        <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Years of reference data to use</span>
monte_carlo_runs                    = 10000,     <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Number of sims</span>

initial_brokerage_balance           = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all normally taxable accounts</span>
initial_ira_balance_p1              = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all tax deferred accounts for p1</span>
initial_ira_balance_p2              = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all tax deferred accounts for p2</span>
initial_roth_balance_p2             = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all roth-like tax deferred accounts for p2</span>
initial_roth_balance_p1             = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all roth-like tax deferred accounts for p1</span>

high_investment_p                   = 100.0,     <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at high growth</span>
mid_investment_p                    = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at medium growth</span>
low_investment_p                    = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at low growth</span>

high_investment_apr                 = 4.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">apr for investments at high growth</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage!</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then do monte carlo with snp_dat</span>
mid_investment_apr                  = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">apr for investments at medium growth</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage!</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to high_investment_apr/2</span>
low_investment_apr                  = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">apr for investments at low growth</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage.</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then do monte carlo with dgs10_dat</span>
cash_position_growth                = 2.5,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">par for cash position in investment accounts</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage.</span>

initial_cash_reserves               = 10000.0,   <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all cash reserves</span>
cash_reserves_growth                = 0.01,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Growth for cash reserves account</span>

initial_emergency_fund              = 10000.0,   <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Near zero risk investments</span>
emergency_fund_growth               = 3.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Rate at which the emergency account grows</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to low_investment_apr</span>

first_year_tax                      = 1000.0,    <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Taxes to pay the first year of the simulation</span>

worst_case_inflation_rate           = -5.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for investment cut-off decisions</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, don't use a cuff-off</span>
fixed_inflation_rate                = 3.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Inflation impacts annual expenses</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then do monte carlo</span>

initial_expected_expenses_shr       = 100000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Shared first year expenses.</span>
initial_expected_expenses_p1        = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year expenses for p1.</span>
initial_expected_expenses_p2        = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year expenses for p2.</span>

social_security_start_age_p1        = 65,        <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year we get SS for p1</span>
social_security_start_age_p2        = 65,        <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year we get SS for p2</span>
initial_social_security_monthly_p1  = 1000.0,    <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Just a guess.  Probably low.</span>
initial_social_security_monthly_p2  = 1000.0,    <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Just a guess.  Probably low.</span>
social_security_growth              = -1.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Usually matches inflation</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to inflation</span>

initial_gross_work_salary_p1        = 100000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Taxable part of p1's salary</span>
initial_gross_work_salary_p2        = 100000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Taxable part of p2's salary</span>
work_salary_growth                  = 2.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Hard to estimate</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to max(0, inflation/2)</span>

initial_annual_ira_contrib_base     = 23000.0,   <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting base contribution</span>
initial_annual_ira_contrib_catchup  = 7000.0,    <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting catchup contribution</span>
annual_ira_contrib_growth           = -3.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Grow 401k contribution (inflation?)</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to inflation</span>

initial_annual_roth_contrib_base    = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting base contribution</span>
initial_annual_roth_contrib_catchup = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting catchup contribution</span>
annual_roth_contrib_growth          = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Grow 401k contribution</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to inflation</span>

target_taxable_income               = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Target tax for roth conversion</span>
minimum_roth_conversion             = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Minimum size of roth conversion</span>
maximum_roth_conversion_year        = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">No conversions after this year</span>

surplus_reinvest                    = 100.0,     <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Percentage of ExtraNS to reinvest</span>

retirement_year_p1                  = 2065,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year p1 is fully retired</span>
retirement_year_p2                  = 2065,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year p2 is fully retired</span>
birthday_p1                         = 2000,      <span style="color: #ffa500;">!!</span>
birthday_p2                         = 2000,      <span style="color: #ffa500;">!!</span>
sex_p1                              = <span style="color: #fa8072;">'M'</span>,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sex of p1 -- selects SSI life table</span>
sex_p2                              = <span style="color: #fa8072;">'F'</span>,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sex of p2 -- selects SSI life table</span>
life_expectancy_p1                  = 110,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Age p1 expects to die</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If zero then compute based on age &amp; sex</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative then use monte carlo</span>
life_expectancy_p2                  = 110,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Age p2 expects to die</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If zero then compute based on age &amp; sex</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative then use monte carlo</span>

verbosity                           = 10         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">How much to print when running</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">-  0 : nothing</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">- 10 : progress</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">- 20 : variables</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">- 30 : more variables</span>
/
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-case_60_intro" class="outline-3">
<h3 id="case_60_intro"><span class="section-number-3">3.2.</span> Approaching Retirement</h3>
<div class="outline-text-3" id="text-case_60_intro">
<p>
Here we have a couple (47 &amp; 55 years old).  Each have 500k in a 401k.  They plan on putting 50% in the S&amp;P, and 50% in
low risk 5% funds. They also have 100k balances in both an emergency fund and checking account.  The checking account
earns 0.01% interest, and the emergency fund is in CDs earning 3%. They are both employed, and are have aggressively
saving at the maximum rate into a 401k.  They spend 110K per year on expenses.  They believe inflation will be about
3%.  They both wish to stop working when they are 60. The younger person will start taking SS at 63 while the older
one will start at age 70.
</p>
</div>

<div id="outline-container-case_60_danger" class="outline-4">
<h4 id="case_60_danger"><span class="section-number-4">3.2.1.</span> A Risky Plan</h4>
<div class="outline-text-4" id="text-case_60_danger">
<p>
In my opinion, this plan is too aggressive.  I know the S&amp;P 500 has an average return of 10% over the last couple decades, but depending on a 7% return is just
too risky.  This is especially true with only 1M in total savings.
</p>

<p>
Things look just fine if we consider a simulation using ideal, fixed growth and inflation.  Here is what the overall savings balance looks:
</p>


<div id="org879bd81" class="figure">
<p><a href="pics/savings_by_type_60o_fix_full.png"><img src="pics/savings_by_type_60o_fix_800x.png" alt="savings_by_type_60o_fix_800x.png" /></a>
</p>
</div>

<p>
If we take a look at the savings probability bands, we see a very different picture:
</p>


<div id="orgd95b97b" class="figure">
<p><a href="pics/savings_by_year_probability_bands_60o_mc_full.png"><img src="pics/savings_by_year_probability_bands_60o_mc_800x.png" alt="savings_by_year_probability_bands_60o_mc_800x.png" /></a>
</p>
</div>

<p>
And if we look at a few paths and the account collapse cases, things look pretty scary:
</p>


<div id="org94b890c" class="figure">
<p><a href="pics/composite_trajectories_60o_mc_full.png"><img src="pics/composite_trajectories_60o_mc_800x.png" alt="composite_trajectories_60o_mc_800x.png" /></a>
</p>
</div>

<p>
Another way to look at this is the distribution of final savings.  That huge bar on the left tells us that running out of money is the single most probable
outcome from this plan.
</p>


<div id="orgae8663a" class="figure">
<p><a href="pics/final_savings_by_type_60o_mc_full.png"><img src="pics/final_savings_by_type_60o_mc_800x.png" alt="final_savings_by_type_60o_mc_800x.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-case_60o_ml" class="outline-4">
<h4 id="case_60o_ml"><span class="section-number-4">3.2.2.</span> An Alternate Plan</h4>
<div class="outline-text-4" id="text-case_60o_ml">
<p>
They can dramatically improve the chances of success by saving more (bumping up total savings by 250k), and spending less (drop annual expenses by 1k).  
</p>

<p>
The new savings probability bands are much more positive:
</p>


<div id="org4f49f2a" class="figure">
<p><a href="pics/savings_by_year_probability_bands_60ml_mc_full.png"><img src="pics/savings_by_year_probability_bands_60ml_mc_800x.png" alt="savings_by_year_probability_bands_60ml_mc_800x.png" /></a>
</p>
</div>

<p>
And the overall path picture is much more positive:
</p>


<div id="org419d075" class="figure">
<p><a href="pics/composite_trajectories_60ml_mc_full.png"><img src="pics/composite_trajectories_60ml_mc_800x.png" alt="composite_trajectories_60ml_mc_800x.png" /></a>
</p>
</div>

<p>
Lastly, the distribution of final savings no longer shows dying broke as the highest probability outcome.
</p>


<div id="orgf02a5ae" class="figure">
<p><a href="pics/final_savings_by_type_60ml_mc_full.png"><img src="pics/final_savings_by_type_60ml_mc_800x.png" alt="final_savings_by_type_60ml_mc_800x.png" /></a>
</p>
</div>
</div>
</div>

<div id="outline-container-case_60_config" class="outline-4">
<h4 id="case_60_config"><span class="section-number-4">3.2.3.</span> Config Files</h4>
<div class="outline-text-4" id="text-case_60_config">
<p>
The original plan config file is here:
</p>

<div class="org-src-container">
<pre class="src src-f90">&amp;SIMPARM
monte_carlo_years                   = 40,        <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Years of reference data to use</span>
monte_carlo_runs                    = 10000,     <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Number of sims</span>

initial_brokerage_balance           = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all normally taxable accounts</span>
initial_ira_balance_p1              = 500000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all tax deferred accounts for p1</span>
initial_ira_balance_p2              = 500000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all tax deferred accounts for p2</span>
initial_roth_balance_p2             = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all roth-like tax deferred accounts for p2</span>
initial_roth_balance_p1             = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all roth-like tax deferred accounts for p1</span>

high_investment_p                   = 80.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at high growth</span>
mid_investment_p                    = 00.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at medium growth</span>
low_investment_p                    = 20.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at low growth</span>

high_investment_apr                 = 7.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">apr for investments at high growth</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage!</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then do monte carlo with snp_dat</span>
mid_investment_apr                  = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">apr for investments at medium growth</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage!</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to high_investment_apr/2</span>
low_investment_apr                  = 5.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">apr for investments at low growth</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage.</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then do monte carlo with dgs10_dat</span>
cash_position_growth                = 2.5,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">par for cash position in investment accounts</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for retirement accounts and the brokerage.</span>

initial_cash_reserves               = 100000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all cash reserves</span>
cash_reserves_growth                = 0.01,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Growth for cash reserves account</span>

initial_emergency_fund              = 100000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Near zero risk investments</span>
emergency_fund_growth               = 2.9,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Rate at which the emergency account grows</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to low_investment_apr</span>

first_year_tax                      = 50000.0,   <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Taxes to pay the first year of the simulation</span>

worst_case_inflation_rate           = -5.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Used for investment cut-off decisions</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, don't use a cuff-off</span>
fixed_inflation_rate                = 3.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Inflation impacts annual expenses</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then do monte carlo</span>

initial_expected_expenses_shr       = 110000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year expenses.</span>
initial_expected_expenses_p1        = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year expenses for p1.</span>
initial_expected_expenses_p2        = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year expenses for p2.</span>

social_security_start_age_p1        = 63,        <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year we get SS for p1</span>
social_security_start_age_p2        = 70,        <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year we get SS for p2</span>
initial_social_security_monthly_p1  = 1000.0,    <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Just a guess.  Probably low.</span>
initial_social_security_monthly_p2  = 1000.0,    <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Just a guess.  Probably low.</span>
social_security_growth              = -1.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Usually matches inflation</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to inflation</span>

initial_gross_work_salary_p1        = 170000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Taxable part of p1's salary</span>
initial_gross_work_salary_p2        = 180000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Taxable part of p2's salary</span>
work_salary_growth                  = 2.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Hard to estimate</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to max(0, inflation/2)</span>

initial_annual_ira_contrib_base     = 23000.0,   <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting base contribution</span>
initial_annual_ira_contrib_catchup  = 7000.0,    <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting catchup contribution</span>
annual_ira_contrib_growth           = -1.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Grow 401k contribution (inflation?)</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to inflation</span>

initial_annual_roth_contrib_base    = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting base contribution</span>
initial_annual_roth_contrib_catchup = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Starting catchup contribution</span>
annual_roth_contrib_growth          = 0.0,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Grow 401k contribution</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative, then set to inflation</span>

target_taxable_income               = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Target tax for roth conversion</span>
minimum_roth_conversion             = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Minimum size of roth conversion</span>
maximum_roth_conversion_year        = 0,         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">No conversions after this year</span>

surplus_reinvest                    = 100.0,     <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Percentage of ExtraNS to reinvest</span>

retirement_year_p1                  = 2037,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year p1 is fully retired</span>
retirement_year_p2                  = 2029,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year p2 is fully retired</span>
birthday_p1                         = 1977,      <span style="color: #ffa500;">!!</span>
birthday_p2                         = 1969,      <span style="color: #ffa500;">!!</span>
sex_p1                              = <span style="color: #fa8072;">'M'</span>,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sex of p1 -- selects SSI life table</span>
sex_p2                              = <span style="color: #fa8072;">'F'</span>,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sex of p2 -- selects SSI life table</span>
life_expectancy_p1                  = 110,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Age p1 expects to die</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If zero then compute based on age &amp; sex</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative then use monte carlo</span>
life_expectancy_p2                  = 110,       <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Age p2 expects to die</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If zero then compute based on age &amp; sex</span>
                                                 <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">If negative then use monte carlo</span>

verbosity                           = 10         <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">How much to print when running</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">-  0 : nothing</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">- 10 : progress</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">- 20 : variables</span>
                                                 <span style="color: #ffa500;">!!  </span><span style="color: #ff7f24;">- 30 : more variables</span>
/
</pre>
</div>

<p>
The updated plan changes these lines
</p>

<div class="org-src-container">
<pre class="src src-f90">initial_ira_balance_p1              = 625000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all tax deferred accounts for p1</span>
initial_ira_balance_p2              = 625000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">Sum of all tax deferred accounts for p2</span>
high_investment_p                   = 50.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at high growth</span>
low_investment_p                    = 20.0,      <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">percentage of investments at low growth</span>
initial_expected_expenses_shr       = 100000.0,  <span style="color: #ffa500;">!! </span><span style="color: #ff7f24;">First year expenses.</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-platforms" class="outline-2">
<h2 id="platforms"><span class="section-number-2">4.</span> Platform Notes &amp; Testing</h2>
<div class="outline-text-2" id="text-platforms">
<p>
Note that MRFFL works on a smaller set of compilers &amp; platforms than the retirement simulator.  In particular, MRFFL has some limitations on what platforms
support the TVM modules because they use nested functions for numerical solvers, and therefore require an executable stack.  The retirement simulator doesn't
use those parts of the TVM modules, and thus is free from those limitations.
</p>
</div>

<div id="outline-container-testenv" class="outline-3">
<h3 id="testenv"><span class="section-number-3">4.1.</span> Tested Environments</h3>
<div class="outline-text-3" id="text-testenv">
<dl class="org-dl">
<dt>MSYS2 running on Windows 11</dt><dd><ul class="org-ul">
<li>GNU Fortran (Rev2, Built by MSYS2 project) 14.2.0 : Everything works</li>
<li>LFortran 0.42.0 LLVM 19.1.3 : Nothing works.  Compiler crashes during compile.</li>
<li>Intel ifx 2024.1.0 Build 20240308 : Everything works</li>
<li>flang 19.1.6 inside clang: Everything works</li>
</ul></dd>
<dt>Debian 12.8 running in WSL on Windows 11</dt><dd><ul class="org-ul">
<li>GNU Fortran (Debian 14.2.0-8) 14.2.0 from debian-testing: Everything works</li>
<li>LFortran 0.42.0 LLVM 19.1.3 : Nothing works.  Compiler crashes during compile.</li>
<li>Intel ifx 2025.0.4 20241205 : Everything works</li>
<li>nvfortran 24.11-0 64-bit target on x86-64 Linux : Everything works.</li>
<li>flang-new version 19.1.6 : Everything works.</li>
</ul></dd>
</dl>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
<br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br /> <br />
</div>
</body>
</html>
